<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Survey Builder</title>
  <style>
    /* Your styles here */
  </style>
</head>
<body>
  <h1>Survey Builder</h1>

  <div>
    <label for="surveyTitle">Survey Title:</label>
    <input type="text" id="surveyTitle">
  </div>

  <div>
    <label for="lockSurvey">Lock Survey:</label>
    <input type="checkbox" id="lockSurvey">
  </div>

  <div>
    <label for="userID">User ID:</label>
    <input type="text" id="userID" placeholder="Enter your user ID" />
  </div>

  <div id="questionsContainer"></div>

  <button type="button" onclick="addQuestion('open-ended')">Add Open-Ended Question</button>
  <button type="button" onclick="addQuestion('boolean')">Add True/False Question</button>
  <button type="button" onclick="addLikertSeries()">Add Likert Scale Series</button>
  <button type="button" onclick="addMultipleSeries()">Add Multiple Series Question</button>
  <button type="button" onclick="addQuestion('multiple-choice')">Add Multiple Choice Question</button>
  <button type="button" onclick="submitSurvey(event)">Submit Survey</button>
  <button type="button" onclick="customizeSurvey()">Customize Survey</button>

  <div id="surveyPreview"></div>

  <script src="script.js"></script>
</body>
</html>

  <script>
    let questionCount = 0;

    // Helper function to send POST requests
    async function sendPostRequest(url, data) {
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          return response.json();
        } else {
          throw new Error(`Failed to send request: ${response.status} ${response.statusText}`);
        }
      } catch (error) {
        console.error('Error sending request:', error);
        throw error;
      }
    }

    // Function to create a new survey
    async function createSurvey(surveyTitle) {
      const data = { title: surveyTitle };
      const response = await sendPostRequest('/submit-survey', data);
      return response.surveyId; // Assuming the server returns the new survey ID
    }

    // Function to create questions for a survey
    async function createQuestions(surveyId, questions) {
      const questionIds = [];
      for (const question of questions) {
        const data = { surveyId, ...question };
        const response = await sendPostRequest('/create-question', data);
        questionIds.push(response.questionId);
      }
      return questionIds;
    }

    // Function to create responses for a survey
    async function createResponses(userId, surveyId, questionIds, responses) {
      const data = { userId, surveyId, questionIds, responses };
      await sendPostRequest('/submit-responses', data);
    }

    // Function to create a user-survey entry
    async function createUserSurveyEntry(userId, surveyId) {
      const data = { userId, surveyId };
      await sendPostRequest('/create-user-survey', data);
    }

    // Function to add a question based on the type
    function addQuestion(questionType) {
      questionCount++;

      const questionsContainer = document.getElementById('questionsContainer');

      const questionDiv = document.createElement('div');
      questionDiv.classList.add('question');

      // Determine the question input based on the type
      let questionInput;
      if (questionType === 'open-ended') {
        questionInput = createOpenEndedQuestion(questionCount);
      } else if (questionType === 'boolean') {
        questionInput = createBooleanQuestion(questionCount);
      } else if (questionType === 'likert') {
        questionInput = createLikertQuestion(questionCount);
      } else if (questionType === 'multiple-choice') {
        questionInput = createMultipleChoiceQuestion(questionCount);
      }

      questionDiv.innerHTML = questionInput;

      questionsContainer.appendChild(questionDiv);
    }

    // Helper function to create an open-ended question input
    function createOpenEndedQuestion(questionCount) {
      const questionId = `question${questionCount}`;
      const responseId = `response${questionCount}`;

      return `<label for="${questionId}">Open-Ended Question ${questionCount}:</label>
              <input type="text" id="${questionId}" name="${questionId}" placeholder="Enter your open-ended question">
              <div id="${responseId}"></div>`;
    }

    // Helper function to create a boolean question input
    function createBooleanQuestion(questionCount) {
      const questionId = `question${questionCount}`;
      const responseId = `response${questionCount}`;

      return `<div>
                <label for="${questionId}">True/False Question ${questionCount}:</label>
                <input type="text" id="${questionId}" name="${questionId}" placeholder="Enter your True/False question">
                <select id="${responseId}" name="${responseId}">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </div>`;
    }

    // Helper function to create a Likert scale question input
    function createLikertQuestion(questionCount) {
      const questionId = `question${questionCount}`;
      const responseId = `response${questionCount}`;

      return `<div>
                <label for="${questionId}">Likert Scale Question ${questionCount}:</label>
                <input type="text" id="${questionId}" name="${questionId}" placeholder="Enter your Likert scale question">
                <select id="${responseId}" name="${responseId}">
                  <option value="1">Strongly Disagree</option>
                  <option value="2">Disagree</option>
                  <option value="3">Neutral</option>
                  <option value="4">Agree</option>
                  <option value="5">Strongly Agree</option>
                </select>
              </div>`;
    }

    // Helper function to create a multiple-choice question input
    function createMultipleChoiceQuestion(questionCount) {
  const questionId = `question${questionCount}`;
  const responseId = `response${questionCount}`;

  return `<label for="${questionId}">Multiple Choice Question ${questionCount}:</label>
          <input type="text" id="${questionId}" name="${questionId}" placeholder="Enter your multiple-choice question">
          <div id="${responseId}">
            <input type="text" placeholder="Option 1">
            <input type="text" placeholder="Option 2">
            <!-- Add more option inputs as needed -->
          </div>`;
}
    // Function to add a series of Likert scale questions
    function addLikertSeries() {
      const numberOfQuestions = prompt('Enter the number of Likert scale questions:');
      for (let i = 1; i <= numberOfQuestions; i++) {
        addQuestion('likert');
      }
    }

    // Function to add a series of multiple-choice questions
    function addMultipleSeries() {
      const numberOfQuestions = prompt('Enter the number of multiple-choice questions in the series:');
      for (let i = 1; i <= numberOfQuestions; i++) {
        addQuestion('multiple-choice');
      }
    }

    // Function to submit the survey data to the server
    async function submitSurvey(event) {
  event.preventDefault(); // Prevent the default form submission behavior

  const userIDElement = document.getElementById('userID');
  const surveyTitle = document.getElementById('surveyTitle').value;
  const lockSurvey = document.getElementById('lockSurvey').checked;

  if (userIDElement) {
    const userID = userIDElement.value;
    const questions = [];

    // Collect questions from the questionsContainer
    const questionsContainer = document.getElementById('questionsContainer');
    const questionElements = questionsContainer.getElementsByClassName('question');

    for (let i = 0; i < questionElements.length; i++) {
      const questionElement = questionElements[i];
      const questionType = questionElement.dataset.type; // Assuming you add data-type attribute to the question div

      const questionText = questionElement.querySelector('input[type="text"]').value;
      const question = { text: questionText, type: questionType };

      if (questionType === 'multiple-choice') {
        const optionsContainer = questionElement.querySelector('div');
        const optionElements = optionsContainer.querySelectorAll('input[type="text"]');
        const options = Array.from(optionElements).map((option) => option.value);
        question.options = options;
      } else if (questionType === 'boolean') {
        const responseElement = questionElement.querySelector('select');
        const response = responseElement.value;
        question.response = response;
      } else if (questionType === 'likert') {
        const responseElement = questionElement.querySelector('select');
        const response = responseElement.value;
        question.response = response;
      }

      questions.push(question);
    }

    const surveyData = {
      userID,
      title: surveyTitle,
      locked: lockSurvey,
      questions,
    };

    try {
      const response = await fetch('/submit-survey', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(surveyData),
      });

      if (response.ok) {
        const { surveyId, questionIds } = await response.json();
        console.log('Survey data submitted successfully');
        // Reset survey builder interface or show confirmation message
      } else {
        console.error('Failed to submit survey data:', response.statusText);
        // Handle error, show error message, or retry submission
      }
    } catch (error) {
      console.error('Error submitting survey data:', error);
      // Handle error, show error message, or retry submission
    }
  } else {
    console.error('Element with ID "userID" not found');
    // Handle the case where the element is not found
  }
} 

    // Function to customize the survey (change background and font color)
    function customizeSurvey() {
      // Function implementation remains the same
    }
  </script>
</body>
</html>
